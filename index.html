<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Invoice App</title>
<style>
    body { font-family: Arial; margin: 20px; }
    .row { display: flex; justify-content: space-between; }
    .col { width: 48%; }
    .invoice-list-item { border: 1px solid #ccc; padding: 10px; margin: 5px 0; display: flex; justify-content: space-between; align-items: center; }
    .status-paid { background: #c8f7c5; }
    .status-unpaid { background: #fff7b3; }
    .status-overdue { background: #f7c5c5; }
</style>
</head>
<body>
<h2><img id="logoPreview" src="" height="60" style="vertical-align:middle"> &nbsp; <input type="file" id="logoUpload" accept="image/*"> <span style="float:right;font-size:40px;font-weight:bold;">INVOICE</span></h2>

<div class="row">
    <div class="col">
        <h3>Client Details</h3>
        <input id="clientName" placeholder="Client Name"><br>
        <input id="clientEmail" placeholder="Client Email"><br>
        <input id="clientPhone" placeholder="Client Phone"><br>
        <textarea id="clientAddress" placeholder="Client Address"></textarea>
    </div>
    <div class="col">
        <h3>Payee Details</h3>
        <input id="payeeName" placeholder="Your Name"><br>
        <input id="payeeBSB" placeholder="BSB"><br>
        <input id="payeeAccount" placeholder="Account Number"><br>
        <input id="payeeABN" placeholder="ABN"><br>
        <textarea id="payeeAddress" placeholder="Your Address"></textarea>
    </div>
</div>

<h3>Invoice Info</h3>
<input id="invoiceNumber" placeholder="Invoice Number"><br>
<input id="invoiceDate" type="date"><br>
<input id="dueDate" type="date"><br>
<textarea id="invoiceNotes" placeholder="Notes"></textarea>

<h3>Items</h3>
<div id="items"></div>
<button onclick="addItem()">Add Item</button>

<br><br>
<select id="invoiceStatus">
    <option value="unpaid">Unpaid</option>
    <option value="paid">Paid</option>
</select>
<button onclick="saveInvoice()">Save Invoice</button>
<button onclick="openInvoiceTab()">Open Invoice</button>

<hr>
<h3>Invoices</h3>
<select id="filter" onchange="renderInvoices()">
    <option value="all">All</option>
    <option value="paid">Paid</option>
    <option value="unpaid">Unpaid</option>
    <option value="overdue">Overdue</option>
</select>
<div id="invoiceList"></div>

<script>
let savedFields = ['payeeName','payeeBSB','payeeAccount','payeeABN','invoiceNumber','invoiceDate','invoiceNotes'];

function loadSavedFields(){
  savedFields.forEach(id=>{ let v=localStorage.getItem(id); if(v!==null) document.getElementById(id).value=v; });
  let logo = localStorage.getItem('logo'); if(logo) document.getElementById('logoPreview').src = logo;
}
function saveField(id){ localStorage.setItem(id, document.getElementById(id).value); }

['logoUpload'].forEach(id=>{
  document.getElementById(id).addEventListener('change',e=>{
    let file=e.target.files[0]; let r=new FileReader();
    r.onload=(ev)=>{ localStorage.setItem('logo',ev.target.result); document.getElementById('logoPreview').src=ev.target.result; }
    if(file) r.readAsDataURL(file);
  });
});

savedFields.forEach(id=>{
  document.getElementById(id).addEventListener('input',()=>saveField(id));
});

function addItem(){
  let d=document.createElement('div');
  d.innerHTML = '<input class="desc" placeholder="Description"> <input class="amt" type="number" placeholder="Amount">';
  document.getElementById('items').appendChild(d);
}

function saveInvoice(){
  let inv = JSON.parse(localStorage.getItem('invoices')||'[]');
  let obj={
    id: Date.now(),
    client:{name:clientName.value,email:clientEmail.value,phone:clientPhone.value,address:clientAddress.value},
    payee:{name:payeeName.value,bsb:payeeBSB.value,acc:payeeAccount.value,abn:payeeABN.value,address:payeeAddress.value},
    meta:{number:invoiceNumber.value,date:invoiceDate.value,due:dueDate.value,notes:invoiceNotes.value,status:invoiceStatus.value},
    items:[...document.querySelectorAll('#items div')].map(el=>({d:el.querySelector('.desc').value,a:el.querySelector('.amt').value}))
  };
  inv.push(obj);
  localStorage.setItem('invoices',JSON.stringify(inv));
  renderInvoices();
}

function renderInvoices(){
  let inv = JSON.parse(localStorage.getItem('invoices')||'[]');
  let f = filter.value;
  let out='';
  let now = new Date().toISOString().split('T')[0];

  inv.forEach(x=>{
    let status = x.meta.status;
    if(x.meta.due && x.meta.due < now && status!=='paid') status='overdue';
    if(f!=='all' && status!==f) return;

    let cls = status==='paid'?'status-paid':status==='overdue'?'status-overdue':'status-unpaid';
    out += `<div class="invoice-list-item ${cls}">#${x.meta.number} - ${x.client.name}
      <button onclick="openSpecific(${x.id})">Open</button>
      <button onclick="delInv(${x.id})">Delete</button></div>`;
  });
  invoiceList.innerHTML = out;
}

function openSpecific(id){
  let inv = JSON.parse(localStorage.getItem('invoices')||'[]').find(x=>x.id===id);
  let w=window.open();
  w.document.write('<pre>'+JSON.stringify(inv,null,2)+'</pre>');
}

function openInvoiceTab(){ openSpecific(); }

function delInv(id){ if(confirm('Delete invoice?')){
  let inv = JSON.parse(localStorage.getItem('invoices')||'[]');
  inv = inv.filter(x=>x.id!==id);
  localStorage.setItem('invoices',JSON.stringify(inv));
  renderInvoices();
}}

loadSavedFields();
renderInvoices();
</script>
</body>
</html>
