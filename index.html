<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invoice Generator</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f2f2f2; }
h1 { text-align: center; }
input, textarea, select { width: 100%; margin: 5px 0 10px; padding: 8px; box-sizing: border-box; }
button { padding: 6px 12px; margin: 2px; cursor: pointer; }
.invoice-item { display: flex; gap: 10px; margin-bottom: 8px; }
.invoice-item input { flex: 1; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
th, td { border: 1px solid #000; padding: 6px; text-align: left; }
th { background: #eee; }
hr { margin: 25px 0; }
.flex-row { display: flex; justify-content: space-between; gap: 20px; }
.flex-column { flex: 1; }
#logoPreview { max-width:150px; display:block; margin-bottom:10px; }
</style>
</head>
<body>

<h1>Invoice Generator</h1>

<h3>Upload Logo</h3>
<input type="file" id="logoInput" accept="image/*">
<img id="logoPreview" src="">

<h3>Create Invoice</h3>

<div class="flex-row">
  <div class="flex-column">
    <h4>Client Details</h4>
    <input type="text" id="clientName" placeholder="Client Name">
    <input type="text" id="clientPhone" placeholder="Phone">
    <input type="email" id="clientEmail" placeholder="Email">
  </div>
  <div class="flex-column">
    <h4>Payee Details</h4>
    <input type="text" id="payeeName" placeholder="Company Name">
    <input type="text" id="payeeBSB" placeholder="BSB">
    <input type="text" id="payeeAccount" placeholder="Account Number">
  </div>
</div>

<h4>Invoice Details</h4>
<input type="text" id="invoiceNumber" placeholder="Invoice #">
<input type="date" id="invoiceDate">
<input type="date" id="dueDate" placeholder="Due Date">
<select id="invoiceStatus">
  <option value="Unpaid">Unpaid</option>
  <option value="Paid">Paid</option>
  <option value="Overdue">Overdue</option>
</select>

<h4>Items</h4>
<div id="items"></div>
<button onclick="addItem()">Add Item</button>

<h4>Notes</h4>
<textarea id="notes" placeholder="Additional notes..."></textarea>
<br>
<button onclick="saveInvoice()">Save Invoice</button>

<hr>
<h3>Invoice List</h3>
<label>Filter by Status:</label>
<select id="filterStatus" onchange="renderInvoiceList()">
  <option value="All">All</option>
  <option value="Paid">Paid</option>
  <option value="Unpaid">Unpaid</option>
  <option value="Overdue">Overdue</option>
</select>

<table id="invoiceTable">
  <thead>
    <tr>
      <th>Invoice #</th>
      <th>Client</th>
      <th>Date</th>
      <th>Due Date</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let itemsContainer = document.getElementById('items');
let invoices = JSON.parse(localStorage.getItem('invoices') || '[]');
let logoDataURL = localStorage.getItem('invoiceLogo') || "";
const logoPreview = document.getElementById('logoPreview');
if(logoDataURL) logoPreview.src = logoDataURL;

// Logo upload
document.getElementById('logoInput').addEventListener('change', e=>{
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = evt => {
      logoDataURL = evt.target.result;
      localStorage.setItem('invoiceLogo', logoDataURL);
      logoPreview.src = logoDataURL;
    }
    reader.readAsDataURL(file);
  }
});

// Auto add first item
window.onload = () => { addItem(); renderInvoiceList(); }

function addItem() {
  const div = document.createElement('div');
  div.className = 'invoice-item';
  div.innerHTML = `
    <input type="text" placeholder="Description">
    <input type="number" placeholder="Qty" min="0">
    <input type="number" placeholder="Price" min="0" step="0.01">
    <button onclick="this.parentElement.remove()">Remove</button>
  `;
  itemsContainer.appendChild(div);
}

function saveInvoice() {
  const clientName = document.getElementById('clientName').value;
  const clientPhone = document.getElementById('clientPhone').value;
  const clientEmail = document.getElementById('clientEmail').value;
  const invoiceNumber = document.getElementById('invoiceNumber').value;
  const invoiceDate = document.getElementById('invoiceDate').value;
  const dueDate = document.getElementById('dueDate').value;
  const notes = document.getElementById('notes').value;
  const status = document.getElementById('invoiceStatus').value;
  const payeeName = document.getElementById('payeeName').value;
  const payeeBSB = document.getElementById('payeeBSB').value;
  const payeeAccount = document.getElementById('payeeAccount').value;

  const items = Array.from(document.querySelectorAll('.invoice-item'))
    .map(item => {
      const inputs = item.querySelectorAll('input');
      return { description: inputs[0].value, qty: parseFloat(inputs[1].value)||0, price: parseFloat(inputs[2].value)||0 };
    })
    .filter(item => item.description || item.qty>0 || item.price>0);

  if(!clientName || !invoiceNumber || !invoiceDate){
    alert("Please fill client, invoice #, and date.");
    return;
  }

  invoices.push({ clientName, clientPhone, clientEmail, invoiceNumber, invoiceDate, dueDate, notes, status, payeeName, payeeBSB, payeeAccount, items, logo: logoDataURL });
  localStorage.setItem('invoices', JSON.stringify(invoices));

  // Clear form
  ['clientName','clientPhone','clientEmail','invoiceNumber','invoiceDate','dueDate','notes','payeeName','payeeBSB','payeeAccount'].forEach(id => document.getElementById(id).value='');
  itemsContainer.innerHTML=''; addItem(); renderInvoiceList();
}

function renderInvoiceList() {
  const tbody = document.querySelector('#invoiceTable tbody');
  tbody.innerHTML='';
  const filter = document.getElementById('filterStatus').value;
  invoices.forEach((inv,index)=>{
    if(filter!=='All' && inv.status!==filter) return;
    const tr = document.createElement('tr');
    tr.innerHTML=`
      <td>${inv.invoiceNumber}</td>
      <td>${inv.clientName}</td>
      <td>${inv.invoiceDate}</td>
      <td>${inv.dueDate}</td>
      <td>${inv.status}</td>
      <td>
        <button onclick="openInvoice(${index})">Open</button>
        <button onclick="markPaid(${index})">Mark Paid</button>
        <button onclick="deleteInvoice(${index})">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function openInvoice(index) {
  const inv = invoices[index];
  const total = inv.items.reduce((sum,i)=>sum+i.qty*i.price,0);
  const itemsHtml = inv.items.map(i=>`<tr><td>${i.description}</td><td>${i.qty}</td><td>${i.price.toFixed(2)}</td><td>${(i.qty*i.price).toFixed(2)}</td></tr>`).join('');
  const html = `
    <html><head><title>Invoice ${inv.invoiceNumber}</title>
    <style>
      body{font-family:Arial,sans-serif;padding:20px;}
      h1,h2{text-align:center;}
      table{width:100%;border-collapse:collapse;margin-top:20px;}
      th,td{border:1px solid #000;padding:6px;text-align:left;}
      th{background:#eee;}
      .flex-row{display:flex;justify-content:space-between;}
    </style>
    </head>
    <body>
      ${inv.logo?`<img src="${inv.logo}" style="max-width:200px;display:block;margin:auto;">`:''}
      <h1>Invoice</h1>
      <h2>Invoice #: ${inv.invoiceNumber}</h2>
      <div class="flex-row">
        <div>
          <h3>Customer</h3>
          <p><strong>Name:</strong> ${inv.clientName}</p>
          <p><strong>Phone:</strong> ${inv.clientPhone}</p>
          <p><strong>Email:</strong> ${inv.clientEmail}</p>
        </div>
        <div>
          <h3>Payee</h3>
          <p><strong>Company:</strong> ${inv.payeeName}</p>
          <p><strong>BSB:</strong> ${inv.payeeBSB}</p>
          <p><strong>Account:</strong> ${inv.payeeAccount}</p>
        </div>
      </div>
      <h3>Invoice Details</h3>
      <p><strong>Date:</strong> ${inv.invoiceDate}</p>
      <p><strong>Due:</strong> ${inv.dueDate}</p>
      <p><strong>Status:</strong> ${inv.status}</p>
      <h3>Items</h3>
      <table>
        <tr><th>Description</th><th>Qty</th><th>Price</th><th>Total</th></tr>
        ${itemsHtml}
        <tr><th colspan="3">Total</th><th>${total.toFixed(2)}</th></tr>
      </table>
      <h3>Notes</h3><p>${inv.notes}</p>
    </body></html>
  `;
  const newTab = window.open(); newTab.document.write(html); newTab.document.close();
}

function markPaid(index){
  invoices[index].status="Paid";
  localStorage.setItem('invoices',JSON.stringify(invoices));
  renderInvoiceList();
}

function deleteInvoice(index){
  if(confirm("Are you sure you want to delete this invoice?")){
    invoices.splice(index,1);
    localStorage.setItem('invoices',JSON.stringify(invoices));
    renderInvoiceList();
  }
}
</script>
</body>
</html>
