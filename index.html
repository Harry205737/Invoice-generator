<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Invoice Generator</title>
<style>
    body { font-family: Arial; margin: 20px; }

    h1 { margin: 0; }

    .flex { display: flex; justify-content: space-between; gap: 20px; }

    .invoice-list-item {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 8px;
        border-left-width: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .status-paid { border-left-color: green; background: #e9ffe9; }
    .status-unpaid { border-left-color: goldenrod; background: #fff9d6; }
    .status-overdue { border-left-color: red; background: #ffe6e6; }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #000; padding: 6px; text-align: left; }
</style>
</head>
<body>

<h2>Invoice Creator</h2>

<label>Upload Logo:
    <input type="file" id="logoUpload" accept="image/*">
</label>
<br><br>

<div class="flex">
    <div style="width:48%">
        <h3>Client Details</h3>
        <input id="clientName" placeholder="Client Name" style="width:100%"><br><br>
        <input id="clientAddress" placeholder="Address" style="width:100%"><br><br>
        <input id="clientPhone" placeholder="Phone" style="width:100%"><br><br>
        <input id="clientEmail" placeholder="Email" style="width:100%">
    </div>

    <div style="width:48%">
        <h3>Payee Details</h3>
        <input id="payeeName" placeholder="Your Name / Business" style="width:100%"><br><br>
        <input id="payeeAddress" placeholder="Address" style="width:100%"><br><br>
        <input id="payeeBSB" placeholder="BSB" style="width:48%"> 
        <input id="payeeACC" placeholder="Account No." style="width:48%"><br><br>
        <input id="payeeEmail" placeholder="Email" style="width:100%">
    </div>
</div>

<br>

<label>Due Date: <input type="date" id="dueDate"></label>
<br><br>

<h3>Items</h3>
<div id="itemList"></div>
<button onclick="addItem()">Add Item</button>

<br><br>
<button onclick="saveInvoice()">Save Invoice</button>

<hr>

<h2>Invoices</h2>
<div id="invoiceList"></div>

<script>
let logoData = "";

document.getElementById("logoUpload").addEventListener("change", function(e) {
    const reader = new FileReader();
    reader.onload = () => { logoData = reader.result; };
    reader.readAsDataURL(e.target.files[0]);
});

function addItem() {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
        <input placeholder="Description">
        <input type="number" placeholder="Qty" step="1" style="width:60px">
        <input type="number" placeholder="Price" step="0.01" style="width:100px">
        <button onclick="this.parentElement.remove()">X</button>
    `;
    itemList.appendChild(div);
}

function saveInvoice() {
    const id = Date.now();

    const items = [...document.querySelectorAll(".item")].map(x => {
        const i = x.querySelectorAll("input");
        return {
            desc: i[0].value,
            qty: Number(i[1].value),
            price: Number(i[2].value)
        };
    });

    const invoice = {
        id,
        logo: logoData,
        client: {
            name: clientName.value,
            address: clientAddress.value,
            phone: clientPhone.value,
            email: clientEmail.value
        },
        payee: {
            name: payeeName.value,
            address: payeeAddress.value,
            bsb: payeeBSB.value,
            acc: payeeACC.value,
            email: payeeEmail.value
        },
        due: dueDate.value,
        status: "unpaid",
        items
    };

    const invoices = getInvoices();
    invoices.push(invoice);
    localStorage.setItem("invoices", JSON.stringify(invoices));
    loadInvoices();
    alert("Invoice saved!");
}

function getInvoices() {
    return JSON.parse(localStorage.getItem("invoices") || "[]");
}

function loadInvoices() {
    const list = document.getElementById("invoiceList");
    list.innerHTML = "";
    const invoices = getInvoices();

    invoices.forEach(inv => {
        updateOverdue(inv);

        const row = document.createElement("div");
        row.className = `invoice-list-item status-${inv.status}`;

        row.innerHTML = `
            <div>
                <strong>Invoice #${inv.id}</strong><br>
                Client: ${inv.client.name}<br>
                Due: ${inv.due}<br>
                Status: 
                <select onchange="changeStatus(${inv.id}, this.value)">
                    <option value="paid" ${inv.status==="paid"?"selected":""}>Paid</option>
                    <option value="unpaid" ${inv.status==="unpaid"?"selected":""}>Unpaid</option>
                    <option value="overdue" ${inv.status==="overdue"?"selected":""}>Overdue</option>
                </select>
            </div>
            <div>
                <button onclick="openInvoice(${inv.id})">Open</button>
                <button onclick="deleteInvoice(${inv.id})">Delete</button>
            </div>
        `;

        list.appendChild(row);
    });
}

function updateOverdue(inv) {
    if (inv.status !== "paid") {
        if (new Date(inv.due) < new Date()) {
            inv.status = "overdue";
            localStorage.setItem("invoices", JSON.stringify(getInvoices()));
        }
    }
}

function changeStatus(id, status) {
    const invoices = getInvoices();
    const inv = invoices.find(x => x.id === id);
    inv.status = status;
    localStorage.setItem("invoices", JSON.stringify(invoices));
    loadInvoices();
}

function deleteInvoice(id) {
    if (!confirm("Delete this invoice?")) return;
    let invoices = getInvoices();
    invoices = invoices.filter(x => x.id !== id);
    localStorage.setItem("invoices", JSON.stringify(invoices));
    loadInvoices();
}

function openInvoice(id) {
    const inv = getInvoices().find(x => x.id === id);

    let total = 0;
    inv.items.forEach(i => total += i.qty * i.price);

    const win = window.open("", "_blank");
    win.document.write(`
        <html><body>
        <div style="display:flex;justify-content:space-between;align-items:center;">
            <img src="${inv.logo}" style="height:80px;">
            <h1>INVOICE</h1>
        </div>

        <hr>

        <div style="display:flex;justify-content:space-between;">
            <div>
                <h3>Client</h3>
                ${inv.client.name}<br>
                ${inv.client.address}<br>
                ${inv.client.phone}<br>
                ${inv.client.email}
            </div>

            <div>
                <h3>Payee</h3>
                ${inv.payee.name}<br>
                ${inv.payee.address}<br>
                BSB: ${inv.payee.bsb}<br>
                ACC: ${inv.payee.acc}<br>
                ${inv.payee.email}
            </div>
        </div>

        <br>
        <strong>Due Date:</strong> ${inv.due}
        <br><br>

        <table>
            <tr><th>Description</th><th>Qty</th><th>Price</th><th>Total</th></tr>
            ${inv.items.map(i => `
                <tr>
                    <td>${i.desc}</td>
                    <td>${i.qty}</td>
                    <td>$${i.price.toFixed(2)}</td>
                    <td>$${(i.qty * i.price).toFixed(2)}</td>
                </tr>
            `).join("")}
            <tr><td colspan="3"><strong>Total</strong></td><td><strong>$${total.toFixed(2)}</strong></td></tr>
        </table>
        </body></html>
    `);
}

loadInvoices();
addItem();
</script>
</body>
</html>
